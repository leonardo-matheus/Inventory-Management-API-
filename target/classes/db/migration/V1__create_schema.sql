CREATE TABLE usuario (
                         id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                         username VARCHAR(60) NOT NULL,
                         password VARCHAR(120) NOT NULL,
                         role VARCHAR(30) NOT NULL,
                         ativo BOOLEAN NOT NULL,
                         CONSTRAINT uk_usuario_username UNIQUE (username)
);

CREATE TABLE produto (
                         id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                         sku VARCHAR(50) NOT NULL,
                         nome VARCHAR(150) NOT NULL,
                         descricao VARCHAR(500),
                         preco_unitario NUMERIC(19,2) NOT NULL,
                         ativo BOOLEAN NOT NULL,
                         CONSTRAINT uk_produto_sku UNIQUE (sku)
);

CREATE TABLE deposito (
                          id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                          nome VARCHAR(120) NOT NULL,
                          codigo VARCHAR(30) NOT NULL,
                          endereco VARCHAR(255),
                          CONSTRAINT uk_deposito_codigo UNIQUE (codigo)
);

CREATE TABLE estoque (
                         id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                         produto_id BIGINT NOT NULL,
                         deposito_id BIGINT NOT NULL,
                         quantidade_atual BIGINT NOT NULL,
                         CONSTRAINT fk_estoque_produto FOREIGN KEY (produto_id) REFERENCES produto (id),
                         CONSTRAINT fk_estoque_deposito FOREIGN KEY (deposito_id) REFERENCES deposito (id),
                         CONSTRAINT uk_estoque_produto_deposito UNIQUE (produto_id, deposito_id)
);

CREATE TABLE movimento_estoque (
                                   id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                                   tipo_movimento VARCHAR(10) NOT NULL,
                                   produto_id BIGINT NOT NULL,
                                   deposito_id BIGINT NOT NULL,
                                   quantidade BIGINT NOT NULL,
                                   data_hora_movimento TIMESTAMP WITH TIME ZONE NOT NULL,
                                   observacao VARCHAR(255),
                                   usuario_responsavel VARCHAR(80),
                                   CONSTRAINT fk_movimento_produto FOREIGN KEY (produto_id) REFERENCES produto (id),
                                   CONSTRAINT fk_movimento_deposito FOREIGN KEY (deposito_id) REFERENCES deposito (id)
);

-- Usuário admin inicial (senha: admin123, BCrypt gerado com BCryptPasswordEncoder)
INSERT INTO usuario (username, password, role, ativo)
VALUES (
           'admin',
           '$2a$10$wMME.fAm1bGOnhcBG2T7YulByUp/LhhuG6qJGbW8u6EEpd3PUSda.', -- senha: admin123
           'ROLE_ADMIN',
           TRUE
       );

INSERT INTO produto (sku, nome, descricao, preco_unitario, ativo)
VALUES ('SKU-001', 'Produto Exemplo', 'Produto de teste', 10.00, TRUE);

INSERT INTO deposito (nome, codigo, endereco)
VALUES ('Depósito Central', 'DEP-001', 'Rua A, 123');